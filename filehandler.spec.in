#
# spec file for package @PACKAGE_NAME@
#
# @COPYRIGHT@
#
# All modifications and additions to the file contributed by third parties
# remain the property of their copyright owners, unless otherwise agreed
# upon. The license for this file, and modifications and additions to the
# file, is the same license as for the pristine package itself (unless the
# license for the pristine package is not an Open Source License, in which
# case the license is the MIT License). An "Open Source License" is a
# license that conforms to the Open Source Definition (Version 1.9)
# published by the Open Source Initiative.

%global _lto_cflags %{?_lto_cflags} -ffat-lto-objects

%define progName @PACKAGE_NAME@
%define libName lib@PACKAGE_NAME@
%define srcVersion @VERSION@
%define majorVersion @LIBRARY_OLD_INTERFACE@
%define gcc_version 11

Name:           @PROGRAM_NAME@
Version:        @GIT_VERSION@
Release:        0
License:        @LICENSE_SHORT_RPM@
Summary:        @PROGRAM_SUMMARY@
Url:            @PACKAGE_HOMEPAGE@
Group:          System/Libraries
Source:         @PACKAGE_NAME@-@VERSION@.tar.xz
BuildRequires:  gcc%{gcc_version}-c++
BuildRequires:  fdupes
BuildRequires:  gtest
BuildRequires:  gmock
BuildRequires:  pkgconfig(cpplogger) >= 0.1.0
BuildRequires:  pkgconfig(pluginframework) >= 0.0.1
BuildRequires:  pkgconfig(gpsdata) >= 0.0.3
BuildRequires:  pkgconfig(libgpsdata-utils) >= 0.0.3
BuildRequires:  pkgconfig(gpxlib)
BuildRequires:  pkgconfig(libxml-2.0) >= 2.9
BuildRoot:      %{_tmppath}/%{name}-%{srcVersion}-build

%description
@PROGRAM_DESCRIPTION@

%package devel
Summary:        Development files for libgchart
Group:          Development/Sources
Requires:       %{libName}-%{majorVersion} = %{version}

%description devel
Development files for @PACKAGE_NAME@.
@PROGRAM_DESCRIPTION@

%package -n %{libName}%{majorVersion}
Summary:        @PROGRAM_SUMMARY@
Group:          System/Libraries

%description -n %{libName}%{majorVersion}
@PROGRAM_DESCRIPTION@

%package -n %{progName}-plugin-gpx
Summary:        Plugin to handle reading and writing of gpx file
Group:          System/Libraries
Requires:       %{libName}%{majorVersion} = %{version}

%description -n %{progName}-plugin-gpx
@PROGRAM_DESCRIPTION@

%package -n %{progName}-plugin-openambit
Summary:        Plugin to handle reading and writing of openambit-xml file
Group:          System/Libraries
Requires:       %{libName}%{majorVersion} = %{version}

%description -n %{progName}-plugin-openambit
@PROGRAM_DESCRIPTION@


%prep
%setup -q -n %{progName}-%{srcVersion}

%build
export CC=gcc-%{gcc_version}
export CXX=g++-%{gcc_version}
export GCOV=gcov-%{gcc_version}
%configure --disable-static --disable-debug --enable-release --enable-gtest --disable-example
make %{?_smp_mflags}

%install
%make_install

%check
make check %{?_smp_mflags}
make clean

%post -n %{libName}%{majorVersion}
/sbin/ldconfig

%postun -n %{libName}%{majorVersion}
/sbin/ldconfig

%files devel
%defattr(-,root,root)
%doc ChangeLog README AUTHORS
%license LICENSE
%{_includedir}/%{progName}.hpp
%{_includedir}/%{progName}
%_libdir/%{libName}.la
%_libdir/%{libName}.so
%{_libdir}/pkgconfig/%{libName}.pc
%{_libdir}/%{progName}/gpx.la
%{_libdir}/%{progName}/openambit.la

%files -n %{libName}%{majorVersion}
%defattr(-,root,root)
%license LICENSE
%{_libdir}/%{libName}.so.*
%dir %{_libdir}/%{progName}

%files -n %{progName}-plugin-gpx
%defattr(-,root,root)
%license LICENSE
%{_libdir}/%{progName}/gpx.so

%files -n %{progName}-plugin-openambit
%defattr(-,root,root)
%license LICENSE
%{_libdir}/%{progName}/openambit.so

%changelog
